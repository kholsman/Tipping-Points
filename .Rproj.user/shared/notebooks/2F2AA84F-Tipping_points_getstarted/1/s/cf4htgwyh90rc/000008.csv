"0",""
"0","  # pre-allocate NA Matrix"
"0","  # ------------------------------------"
"0","    Deriv1 <- "
"0","    Deriv2 <- "
"0","    hatFit <- "
"0","    hatse  <- matrix(NA,boot_nobsIN,length(x))"
"0","    gmlist <- list()"
"0","    boot_n    <- 1000 # number of bootstrap runs"
"0","    boot_nobs <- 1000 # optional subsample, if boot_nobs > sample nobs, is set = sample nobs"
"0","    knotsIN   <- t_knots # number of knots, set to 4 in Holsman et al. 2020"
"0","    "
"0","    sdmult   <- 1 # 1 sd"
"0","    method   <- methodIN  # Holsman et al. 2020 used method 2"
"0","    probIN   <-  c(.025,.5,.975) # probablities for the quantile ranges"
"0","    spanIN   <- span_set  # default set to 0.1"
"0","    "
"0","  # Run the boot strap"
"0","  # ------------------------------------"
"0","  pb <- progress_bar$new(total = boot_n)"
"0","  for(int in 1:boot_n){"
"0","     pb$tick()"
"0","    # get bootstraped sub-sample"
"0","    nobs          <- length(dd$num)"
"0","    if(boot_nobs > nobs) "
"0","      boot_nobs   <- nobs"
"0","    "
"0","    bootd         <- sample_n(dd,boot_nobs,replace = TRUE)"
"0","    tmpgam        <- gam(delta_var_prcnt~s(TempC,k=knotsIN,bs=""tp""),data = bootd)"
"0","    tmpd          <- deriv2(tmpgam,simdat=x)"
"0","    gmlist[[int]] <- tmpgam"
"0","    Deriv1[int,]  <- tmpd$fd_d1"
"0","    Deriv2[int,]  <- tmpd$fd_d2"
"0","    hatFit[int,]  <- predict(tmpgam,se.fit=TRUE,newdata=data.frame(TempC=x))$fit"
"0","    hatse[int,]   <- predict(tmpgam,se.fit=TRUE,newdata=data.frame(TempC=x))$se"
"0","    "
"0","  }"
"2",""
"2","[>----------------------------------------------------------------------------------------------------------------]   1%"
"2",""
"2","[=>---------------------------------------------------------------------------------------------------------------]   1%"
"2",""
"2","[=>---------------------------------------------------------------------------------------------------------------]   2%"
"2",""
"2","[==>--------------------------------------------------------------------------------------------------------------]   2%"
"2",""
"2","[==>--------------------------------------------------------------------------------------------------------------]   3%"
"2",""
"2","[===>-------------------------------------------------------------------------------------------------------------]   3%"
"2",""
"2","[===>-------------------------------------------------------------------------------------------------------------]   4%"
"2",""
"2","[====>------------------------------------------------------------------------------------------------------------]   4%"
"2",""
"2","[====>------------------------------------------------------------------------------------------------------------]   5%"
"2",""
"2","[=====>-----------------------------------------------------------------------------------------------------------]   5%"
"2",""
"2","[=====>-----------------------------------------------------------------------------------------------------------]   6%"
"2",""
"2","[======>----------------------------------------------------------------------------------------------------------]   6%"
"2",""
"2","[======>----------------------------------------------------------------------------------------------------------]   7%"
"2",""
"2","[=======>---------------------------------------------------------------------------------------------------------]   7%"
"2",""
"2","[=======>---------------------------------------------------------------------------------------------------------]   8%"
"2",""
"2","[========>--------------------------------------------------------------------------------------------------------]   8%"
"2",""
"2","[=========>-------------------------------------------------------------------------------------------------------]   8%"
"2",""
"2","[=========>-------------------------------------------------------------------------------------------------------]   9%"
"2",""
"2","[==========>------------------------------------------------------------------------------------------------------]   9%"
"2",""
"2","[==========>------------------------------------------------------------------------------------------------------]  10%"
"2",""
"2","[===========>-----------------------------------------------------------------------------------------------------]  10%"
"2",""
"2","[===========>-----------------------------------------------------------------------------------------------------]  11%"
"2",""
"2","[============>----------------------------------------------------------------------------------------------------]  11%"
"2",""
"2","[============>----------------------------------------------------------------------------------------------------]  12%"
"2",""
"2","[=============>---------------------------------------------------------------------------------------------------]  12%"
"2",""
"2","[=============>---------------------------------------------------------------------------------------------------]  13%"
"2",""
"2","[==============>--------------------------------------------------------------------------------------------------]  13%"
"2",""
"2","[==============>--------------------------------------------------------------------------------------------------]  14%"
"2",""
"2","[===============>-------------------------------------------------------------------------------------------------]  14%"
"2",""
"2","[===============>-------------------------------------------------------------------------------------------------]  15%"
"2",""
"2","[================>------------------------------------------------------------------------------------------------]  15%"
"2",""
"2","[=================>-----------------------------------------------------------------------------------------------]  16%"
"2",""
"2","[==================>----------------------------------------------------------------------------------------------]  16%"
"2",""
"2","[==================>----------------------------------------------------------------------------------------------]  17%"
"2",""
"2","[===================>---------------------------------------------------------------------------------------------]  17%"
"2",""
"2","[===================>---------------------------------------------------------------------------------------------]  18%"
"2",""
"2","[====================>--------------------------------------------------------------------------------------------]  18%"
"2",""
"2","[====================>--------------------------------------------------------------------------------------------]  19%"
"2",""
"2","[=====================>-------------------------------------------------------------------------------------------]  19%"
"2",""
"2","[=====================>-------------------------------------------------------------------------------------------]  20%"
"2",""
"2","[======================>------------------------------------------------------------------------------------------]  20%"
"2",""
"2","[======================>------------------------------------------------------------------------------------------]  21%"
"2",""
"2","[=======================>-----------------------------------------------------------------------------------------]  21%"
"2",""
"2","[=======================>-----------------------------------------------------------------------------------------]  22%"
"2",""
"2","[========================>----------------------------------------------------------------------------------------]  22%"
"2",""
"2","[=========================>---------------------------------------------------------------------------------------]  23%"
"2",""
"2","[==========================>--------------------------------------------------------------------------------------]  24%"
"2",""
"2","[===========================>-------------------------------------------------------------------------------------]  24%"
"2",""
"2","[===========================>-------------------------------------------------------------------------------------]  25%"
"2",""
"2","[============================>------------------------------------------------------------------------------------]  25%"
"2",""
"2","[============================>------------------------------------------------------------------------------------]  26%"
"2",""
"2","[=============================>-----------------------------------------------------------------------------------]  26%"
"2",""
"2","[=============================>-----------------------------------------------------------------------------------]  27%"
"2",""
"2","[==============================>----------------------------------------------------------------------------------]  27%"
"2",""
"2","[==============================>----------------------------------------------------------------------------------]  28%"
"2",""
"2","[===============================>---------------------------------------------------------------------------------]  28%"
"2",""
"2","[===============================>---------------------------------------------------------------------------------]  29%"
"2",""
"2","[================================>--------------------------------------------------------------------------------]  29%"
"2",""
"2","[================================>--------------------------------------------------------------------------------]  30%"
"2",""
"2","[=================================>-------------------------------------------------------------------------------]  30%"
"2",""
"2","[==================================>------------------------------------------------------------------------------]  31%"
"2",""
"2","[===================================>-----------------------------------------------------------------------------]  32%"
"2",""
"2","[====================================>----------------------------------------------------------------------------]  32%"
"2",""
"2","[====================================>----------------------------------------------------------------------------]  33%"
"2",""
"2","[=====================================>---------------------------------------------------------------------------]  33%"
"2",""
"2","[=====================================>---------------------------------------------------------------------------]  34%"
"2",""
"2","[======================================>--------------------------------------------------------------------------]  34%"
"2",""
"2","[======================================>--------------------------------------------------------------------------]  35%"
"2",""
"2","[=======================================>-------------------------------------------------------------------------]  35%"
"2",""
"2","[=======================================>-------------------------------------------------------------------------]  36%"
"2",""
"2","[========================================>------------------------------------------------------------------------]  36%"
"2",""
"2","[========================================>------------------------------------------------------------------------]  37%"
"2",""
"2","[=========================================>-----------------------------------------------------------------------]  37%"
"2",""
"2","[=========================================>-----------------------------------------------------------------------]  38%"
"2",""
"2","[==========================================>----------------------------------------------------------------------]  38%"
"2",""
"2","[===========================================>---------------------------------------------------------------------]  38%"
"2",""
"2","[===========================================>---------------------------------------------------------------------]  39%"
"2",""
"2","[============================================>--------------------------------------------------------------------]  39%"
"2",""
"2","[============================================>--------------------------------------------------------------------]  40%"
"2",""
"2","[=============================================>-------------------------------------------------------------------]  40%"
"2",""
"2","[=============================================>-------------------------------------------------------------------]  41%"
"2",""
"2","[==============================================>------------------------------------------------------------------]  41%"
"2",""
"2","[==============================================>------------------------------------------------------------------]  42%"
"2",""
"2","[===============================================>-----------------------------------------------------------------]  42%"
"2",""
"2","[===============================================>-----------------------------------------------------------------]  43%"
"2",""
"2","[================================================>----------------------------------------------------------------]  43%"
"2",""
"2","[================================================>----------------------------------------------------------------]  44%"
"2",""
"2","[=================================================>---------------------------------------------------------------]  44%"
"2",""
"2","[=================================================>---------------------------------------------------------------]  45%"
"2",""
"2","[==================================================>--------------------------------------------------------------]  45%"
"2",""
"2","[==================================================>--------------------------------------------------------------]  46%"
"2",""
"2","[===================================================>-------------------------------------------------------------]  46%"
"2",""
"2","[====================================================>------------------------------------------------------------]  46%"
"2",""
"2","[====================================================>------------------------------------------------------------]  47%"
"2",""
"2","[=====================================================>-----------------------------------------------------------]  47%"
"2",""
"2","[=====================================================>-----------------------------------------------------------]  48%"
"2",""
"2","[======================================================>----------------------------------------------------------]  48%"
"2",""
"2","[======================================================>----------------------------------------------------------]  49%"
"2",""
"2","[=======================================================>---------------------------------------------------------]  49%"
"2",""
"2","[=======================================================>---------------------------------------------------------]  50%"
"2",""
"2","[========================================================>--------------------------------------------------------]  50%"
"2",""
"2","[========================================================>--------------------------------------------------------]  51%"
"2",""
"2","[=========================================================>-------------------------------------------------------]  51%"
"2",""
"2","[=========================================================>-------------------------------------------------------]  52%"
"2",""
"2","[==========================================================>------------------------------------------------------]  52%"
"2",""
"2","[==========================================================>------------------------------------------------------]  53%"
"2",""
"2","[===========================================================>-----------------------------------------------------]  53%"
"2",""
"2","[===========================================================>-----------------------------------------------------]  54%"
"2",""
"2","[============================================================>----------------------------------------------------]  54%"
"2",""
"2","[=============================================================>---------------------------------------------------]  55%"
"2",""
"2","[==============================================================>--------------------------------------------------]  55%"
"2",""
"2","[==============================================================>--------------------------------------------------]  56%"
"2",""
"2","[===============================================================>-------------------------------------------------]  56%"
"2",""
"2","[===============================================================>-------------------------------------------------]  57%"
"2",""
"2","[================================================================>------------------------------------------------]  57%"
"2",""
"2","[================================================================>------------------------------------------------]  58%"
"2",""
"2","[=================================================================>-----------------------------------------------]  58%"
"2",""
"2","[=================================================================>-----------------------------------------------]  59%"
"2",""
"2","[==================================================================>----------------------------------------------]  59%"
"2",""
"2","[==================================================================>----------------------------------------------]  60%"
"2",""
"2","[===================================================================>---------------------------------------------]  60%"
"2",""
"2","[===================================================================>---------------------------------------------]  61%"
"2",""
"2","[====================================================================>--------------------------------------------]  61%"
"2",""
"2","[====================================================================>--------------------------------------------]  62%"
"2",""
"2","[=====================================================================>-------------------------------------------]  62%"
"2",""
"2","[======================================================================>------------------------------------------]  62%"
"2",""
"2","[======================================================================>------------------------------------------]  63%"
"2",""
"2","[=======================================================================>-----------------------------------------]  63%"
"2",""
"2","[=======================================================================>-----------------------------------------]  64%"
"2",""
"2","[========================================================================>----------------------------------------]  64%"
"2",""
"2","[========================================================================>----------------------------------------]  65%"
"2",""
"2","[=========================================================================>---------------------------------------]  65%"
"2",""
"2","[=========================================================================>---------------------------------------]  66%"
"2",""
"2","[==========================================================================>--------------------------------------]  66%"
"2",""
"2","[==========================================================================>--------------------------------------]  67%"
"2",""
"2","[===========================================================================>-------------------------------------]  67%"
"2",""
"2","[===========================================================================>-------------------------------------]  68%"
"2",""
"2","[============================================================================>------------------------------------]  68%"
"2",""
"2","[=============================================================================>-----------------------------------]  69%"
"2",""
"2","[==============================================================================>----------------------------------]  70%"
"2",""
"2","[===============================================================================>---------------------------------]  70%"
"2",""
"2","[===============================================================================>---------------------------------]  71%"
"2",""
"2","[================================================================================>--------------------------------]  71%"
"2",""
"2","[================================================================================>--------------------------------]  72%"
"2",""
"2","[=================================================================================>-------------------------------]  72%"
"2",""
"2","[=================================================================================>-------------------------------]  73%"
"2",""
"2","[==================================================================================>------------------------------]  73%"
"2",""
"2","[==================================================================================>------------------------------]  74%"
"2",""
"2","[===================================================================================>-----------------------------]  74%"
"2",""
"2","[===================================================================================>-----------------------------]  75%"
"2",""
"2","[====================================================================================>----------------------------]  75%"
"2",""
"2","[====================================================================================>----------------------------]  76%"
"2",""
"2","[=====================================================================================>---------------------------]  76%"
"2",""
"2","[======================================================================================>--------------------------]  77%"
"2",""
"2","[=======================================================================================>-------------------------]  78%"
"2",""
"2","[========================================================================================>------------------------]  78%"
"2",""
"2","[========================================================================================>------------------------]  79%"
"2",""
"2","[=========================================================================================>-----------------------]  79%"
"2",""
"2","[=========================================================================================>-----------------------]  80%"
"2",""
"2","[==========================================================================================>----------------------]  80%"
"2",""
"2","[==========================================================================================>----------------------]  81%"
"2",""
"2","[===========================================================================================>---------------------]  81%"
"2",""
"2","[===========================================================================================>---------------------]  82%"
"2",""
"2","[============================================================================================>--------------------]  82%"
"2",""
"2","[============================================================================================>--------------------]  83%"
"2",""
"2","[=============================================================================================>-------------------]  83%"
"2",""
"2","[=============================================================================================>-------------------]  84%"
"2",""
"2","[==============================================================================================>------------------]  84%"
"2",""
"2","[===============================================================================================>-----------------]  85%"
"2",""
"2","[================================================================================================>----------------]  85%"
"2",""
"2","[================================================================================================>----------------]  86%"
"2",""
"2","[=================================================================================================>---------------]  86%"
"2",""
"2","[=================================================================================================>---------------]  87%"
"2",""
"2","[==================================================================================================>--------------]  87%"
"2",""
"2","[==================================================================================================>--------------]  88%"
"2",""
"2","[===================================================================================================>-------------]  88%"
"2",""
"2","[===================================================================================================>-------------]  89%"
"2",""
"2","[====================================================================================================>------------]  89%"
"2",""
"2","[====================================================================================================>------------]  90%"
"2",""
"2","[=====================================================================================================>-----------]  90%"
"2",""
"2","[=====================================================================================================>-----------]  91%"
"2",""
"2","[======================================================================================================>----------]  91%"
"2",""
"2","[======================================================================================================>----------]  92%"
"2",""
"2","[=======================================================================================================>---------]  92%"
"2",""
"2","[========================================================================================================>--------]  92%"
"2",""
"2","[========================================================================================================>--------]  93%"
"2",""
"2","[=========================================================================================================>-------]  93%"
"2",""
"2","[=========================================================================================================>-------]  94%"
"2",""
"2","[==========================================================================================================>------]  94%"
"2",""
"2","[==========================================================================================================>------]  95%"
"2",""
"2","[===========================================================================================================>-----]  95%"
"2",""
"2","[===========================================================================================================>-----]  96%"
"2",""
"2","[============================================================================================================>----]  96%"
"2",""
"2","[============================================================================================================>----]  97%"
"2",""
"2","[=============================================================================================================>---]  97%"
"2",""
"2","[=============================================================================================================>---]  98%"
"2",""
"2","[==============================================================================================================>--]  98%"
"2",""
"2","[==============================================================================================================>--]  99%"
"2",""
"2","[===============================================================================================================>-]  99%"
"2",""
"2","[===============================================================================================================>-] 100%"
"2",""
"2","[================================================================================================================>] 100%"
"2",""
"2","[=================================================================================================================] 100%"
"2","                                                                                                                        "
"2",""
"0","  "
"0","  "
"0","  # apply quantiles to bootstrap replicates"
"0","  D1_se  <- apply(Deriv1,2,quantile,probs=probIN)"
"0","  D2_se  <- apply(Deriv2,2,quantile,probs=probIN)"
"0","  qnt    <- apply(hatFit,2,quantile,probs=probIN)"
"0","  qntse  <- apply(hatse,2,quantile,probs=probIN)"
"0","  nobs   <- length(x) "
"0","  "
"0","  "
"0","  # first to the gam using 1-3 methods"
"0","    hat_qnt1 <- data.frame(tmp = x,"
"0","                          up  = hat$fit+qnt[3,]-qnt[2,],"
"0","                          mn  = hat$fit,"
"0","                          dwn = hat$fit+qnt[1,]-qnt[2,],"
"0","                          method = ""Method 1"")"
"0","    "
"0","    hat_qnt2 <- data.frame(tmp = x,"
"0","                          up  = hat$fit+sdmult*qntse[2,],"
"0","                          mn  = hat$fit,"
"0","                          dwn = hat$fit-sdmult*qntse[2,],"
"0","                          method = ""Method 2"")"
"0","    "
"0","    hat_qnt3 <- data.frame(tmp = x, "
"0","                          up  = hat$fit+sdmult*hat$se,"
"0","                          mn  = hat$fit,"
"0","                          dwn = hat$fit-sdmult*hat$se,"
"0","                          method = ""Method 3"")"
"0","  "
"0","  ggplot(rbind(hat_qnt1,hat_qnt2,hat_qnt3))+"
"0","    geom_ribbon(aes(x=tmp, ymin=dwn, ymax=up,fill=method))+facet_grid(method~.)+"
"0","    scale_fill_viridis_d(begin = .8, end=0)+"
"0","    theme_minimal()"
