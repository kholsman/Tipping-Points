"0","   "
"0","   "
"0","  pks1    <- sort(c(findPeaks(df1_qnt$smoothed_mn),findPeaks(-df1_qnt$smoothed_mn)))"
"0","  signif1 <- which(!data.table::between(0, df1_qnt$dwn, df1_qnt$up, incbounds=TRUE))"
"0","  thrsh1  <- intersect(which(!data.table::between(0, df1_qnt$dwn, df1_qnt$up, incbounds=TRUE)),pks1)"
"0","  df1_qnt$tmp[thrsh1]"
"1","[1]"
"1","  4.1"
"1","  8.2"
"1","  8.7"
"1","  9.1"
"1","  9.4"
"1"," 10.0"
"1","
"
"0","  "
"0","  # 10% smoothing span"
"0","  df2_qnt$smoothed_mn  <- predict(loess(mn ~ tmp, data=df2_qnt, span=spanIN)) "
"0","  df2_qnt$smoothed_dwn <- predict(loess(dwn ~ tmp, data=df2_qnt, span=spanIN)) "
"0","  df2_qnt$smoothed_up  <- predict(loess(up ~ tmp, data=df2_qnt, span=spanIN)) "
"0","  pks2     <- sort(c(findPeaks(df2_qnt$smoothed_mn),findPeaks(-df2_qnt$smoothed_mn)))"
"0","  pks2_up  <- sort(c(findPeaks(df2_qnt$smoothed_up),findPeaks(-df2_qnt$smoothed_up)))"
"0","  pks2_dwn <- sort(c(findPeaks(df2_qnt$smoothed_dwn),findPeaks(-df2_qnt$smoothed_dwn)))"
"0","  "
"0",""
"0","   "
"0","  hat_qnt$sig <-  df1_qnt$sig <- FALSE"
"0","  df2_qnt$sig <- !between(0, df2_qnt$dwn, df2_qnt$up, incbounds=TRUE)"
"0","  signif2     <- which(!between(0, df2_qnt$dwn, df2_qnt$up, incbounds=TRUE))"
"0","  thrsh2_all  <- intersect(signif2,pks2)"
"0","  thrsh2      <-  which(1==10)"
"0"," "
"0","  if(length(thrsh2_all)>0)"
"0","    thrsh2<-mean(thrsh2_all[which(abs(df2_qnt$smoothed_mn[thrsh2_all])==max(abs(df2_qnt$smoothed_mn[thrsh2_all])))],na.rm=T)"
"0","  "
"0","   "
"0","   plot1<- ggplot(rbind("
"0","    hat_qnt%>%select(driver = tmp,up=smoothed_up, mn=smoothed_mn, "
"0","                     dwn=smoothed_dwn,sig)%>%mutate(method=""a) smoothed gam (s(x))""),"
"0","    df1_qnt%>%select(driver = tmp,up=smoothed_up, mn=smoothed_mn, "
"0","                     dwn=smoothed_dwn,sig)%>%mutate(method=""b) First Deriv (s'(x)""),"
"0","    df2_qnt%>%select(driver = tmp,up=smoothed_up, mn=smoothed_mn,"
"0","                     dwn=smoothed_dwn,sig)%>%mutate(method=""c) Second Deriv (s''(x)"")))+"
"0","     geom_ribbon(aes(x=driver, ymin=dwn, ymax=up,fill=method))+"
"0","     facet_grid(method~.,scales=""free_y"")+"
"0","     geom_hline(yintercept=0,color=""white"")+"
"0","     scale_fill_viridis_d(begin = .8, end=.1)+"
"0","     theme_minimal()"
"0","   "
"0","  plot1 + geom_mark_rect(aes(x=driver, y=up,fill = sig, label = ""sig. range""))+"
"0","    geom_vline (xintercept =df2_qnt$tmp[thrsh2], color = ""red"")"
