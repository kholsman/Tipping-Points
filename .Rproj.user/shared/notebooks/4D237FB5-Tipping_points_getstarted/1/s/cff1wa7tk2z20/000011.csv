"0",""
"0","  datIN <- C_thresh_13_1$datIN"
"0","  datIN$rand  <- 1"
"0","  datIN$group <- paste0(datIN$MC_n,""_"",datIN$Scenario,""_"", datIN$sp)"
"0","  datIN$groupN<- as.numeric(as.factor(datIN$group)) "
"0","  datIN$YearN <- datIN$Year- min(datIN$Year)+1"
"0","  x     <- seq(-3,10,.1) "
"0","  "
"0","  # Based on code from E. Hazen and M. Hunsicker WG36 (PICES)"
"0","  "
"0",""
"0","  # Fit gam with and without autocorrelation "
"0","  #------------------------------------"
"0","  tmp_gam   <-  gam(delta_var_prcnt ~ s(TempC,k=t_knots,bs=""tp""),data = datIN)"
"0","  datIN$dev.resid  <- residuals(tmp_gam,type='deviance')"
"0",""
"0","  # fit the null model"
"0","  null      <- gam(delta_var_prcnt ~ 1,family='gaussian',data = datIN)"
"0","  dr        <- sum(residuals(tmp_gam)^2)"
"0","  dn0       <- sum(residuals(null)^2)"
"0","  gam.dev.expl    <- (dn0-dr)/dn0"
"0","  "
"0","  # from here out use the non-AR gam for the demo"
"0",""
"0","  hat       <-  predict(tmp_gam,se.fit=TRUE, newdata = data.frame(TempC=x) )"
"0","  dd        <-  datIN%>%mutate(TempC = round(TempC,2) )%>%select(TempC, delta_var_prcnt)"
"0","  dd$num    <-  1:length(dd[,1])"
"0","  "
